<?php
namespace App\Models;

use App\config\Database;
use PDO;

class User {
    // ... other methods ...

    public static function addParticipant($username, $email, $password, $avatar = null, $gender = null) {
        $conn = Database::getInstanse()->getConnection();

        // Hash the password
        $password_hash = password_hash($password, PASSWORD_BCRYPT);

        // Prepare the SQL query
        $sql = "INSERT INTO users (username, email, password, avatar, gender) VALUES (?, ?, ?, ?, ?)";
        $stmt = $conn->prepare($sql);

        // Execute the query
        $result = $stmt->execute([$username, $email, $password_hash, $avatar, $gender]);

        if ($result) {
            // Assign participant role
            $user_id = $conn->lastInsertId();
            $role_sql = "INSERT INTO user_roles (user_id, role_id) VALUES (?, (SELECT role_id FROM roles WHERE name_role = 'Participant'))";
            $role_stmt = $conn->prepare($role_sql);
            return $role_stmt->execute([$user_id]);
        }

        return false;
    }
}
?>
